# 小项目 基于套接字的简单通信程序

客户机定时每`500ms`向服务器发送一个随机整数，范围在`1~500`之间；服务器每收到一份数据也同时产生随机整数与收到的数据相加，只有在结果大于`100`时才会把计算结果返回给客户机，而客户机收到超出`100`的结果则立即产生一个新的数据，而不是在间隔`500ms`后。客户机需要产生`20`份数据。

# 运行时间计算

记`N`为`20`份数据中超过`100`的结果的数量，应该有如下推论

1. 一次请求触发新请求的概率为`0.8+0.2*0.8+0.2*0.5*0.2*0.5=0.97`
2. 一个大于`100`的数将平均产生`1+0.97+0.97*0.97+...≈33`次请求

假设一次完整请求耗时`T`，则运行时间平均约为`(20-N)(500+T)+33NT=10000-500N+20T+32NT`

按概率推断`N=19.4`，则运行时间平均为`300+640.8T`

测试机`T≈0.7ms`，总用时平均为`748.56ms`

实际运行`20`次，结果如下
```
512 511 1007 1018 514 521 515 520 1012 1007
521 521 1005 1016 1011 513 516 519 1013 1007
```
均值为`738.95ms`，与预测基本吻合。

# 注意

本代码仅适用于`Linux`，`Windows`下无法编译通过。